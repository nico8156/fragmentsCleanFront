flowchart LR

    subgraph BC[Bounded contexts metier]
        L[likeWl write usecases]
        C[commentWl write usecases]
        T[ticketWl write usecases]
    end

    L --> E[enqueueCommitted]
    C --> E
    T --> E

    E --> S[Outbox state
byId queue byCommandId]

S --> Q[status queued]
Q --> R[processOutbox runtime
choice of next command]

R --> P[status processing]
P --> A[status awaitingAck]
P --> F[status failed]

subgraph SYNC[Evenements serveur]
ACKL[like ack events]
ACKC[comment ack events]
ACKT[ticket ack events]
end

ACKL --> D[dropCommitted]
ACKC --> D
ACKT --> D

D --> S
