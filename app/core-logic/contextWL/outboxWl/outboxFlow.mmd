%%{init: {"theme": "neutral"}}%%
flowchart LR
    intent["UI intent (like / comment / ticket)"] --> optimistic["Optimistic reducer"]
    optimistic --> enqueue[enqueueCommitted]
    enqueue --> process[outboxProcessOnce]
    process --> gateway["likes / comments / tickets GW"]
    gateway --> ack["ACK listener"]
    ack --> drop[dropCommitted]
    process -- error --> undo["undo action"]
    undo --> stateNode["State"]
    drop --> stateNode

    appActive["AppState active"] --> replay["replayLocal()"]
    replay --> process
    replay --> decide["decideAndSync()"]
    decide --> gateway
    netOnline["NetInfo online"] --> process
