flowchart TD

    A[appBootRequested] --> B[Hydration via redux persist]
    B --> C[Rehydrate Outbox]

    C -->|queue non vide| D[outboxProcessOnce]
    C -->|queue vide| E[Init Auth and Location]

    D --> E

    E --> F[Fetch global data - coffees, photos, horaires]
    F --> G{User authenticated}

    G -->|oui| H[Fetch entitlements]
    G -->|non| I[Skip entitlements]

    H --> J[replayRequested]
    I --> J[replayRequested]

    J --> K[syncDecideRequested]
    K --> L[appWarmupDone and appBootSucceeded]

    M[appBecameActive] --> N[outboxProcessOnce]
    N --> O[replayRequested]
    O --> P[syncDecideRequested]

    Q[appConnectivityChanged online true] --> R[outboxProcessOnce]
    R --> S[syncDecideRequested]
