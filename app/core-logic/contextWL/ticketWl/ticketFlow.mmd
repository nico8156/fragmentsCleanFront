%% Ticket submit & ack flow
%%{init: {"theme": "neutral"}}%%
flowchart LR
    Intent[UI: uiTicketSubmitRequested] --> UseCase[ticketSubmitUseCaseFactory]
    UseCase --> Optimistic[ticketOptimisticCreated]
    UseCase --> Enqueue[enqueueCommitted (TicketVerify)]
    Enqueue --> Outbox[outboxProcessOnce]
    Outbox --> Gateway[gateway.tickets.verify]
    Gateway --> Ack[onTicketConfirmedAck / onTicketRejectedAck]
    Ack --> Reducer[ticketWl.reducer]
    Ack --> Entitlements[ackEntitlementsListener]
    Reducer --> UI
